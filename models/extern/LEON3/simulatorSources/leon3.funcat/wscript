#!/usr/bin/env python
# vim : set fileencoding=utf-8 expandtab noai ts=4 sw=4 filetype=python :
TOP = '../../../../..'
import os

def build(bld):
    sources = """
        instructions.cpp
        registers.cpp
        alias.cpp
        processor.cpp
        interface.cpp
        decoder.cpp
        memory.cpp
        externalPorts.cpp
        irqPorts.cpp
        externalPins.cpp
    """

    uselib = 'GREENSOCS ELF_LIB BOOST BOOST_PROGRAM_OPTIONS BOOST_THREAD BOOST_FILESYSTEM BOOST_SYSTEM SYSTEMC TLM'
    use = 'mmu_cache utils signalkit common trap'

    bld.install_files('${PREFIX}/include/', bld.path.parent.ant_glob(['leon3.funcat.h','leon3.funcat/*.hpp']), cwd=bld.path.parent, relative_trick=True)

    bld(
        target          = 'leon3.funcat',
        features        = 'cxx cxxstlib',
        export_includes = '..',
        includes        = '..',
        uselib          = uselib,
        use             = use,
        source          = sources,
        install_path    = '${PREFIX}/lib',
    )

    sources = sources + 'main.cpp'
    bld.program(
        target = 'leon3.funcat.platform', 
        includes = '..', 
        defines = 'LEON3_STANDALONE',
        source = sources, 
        uselib = uselib, 
        use = use,
    )
